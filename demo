pipeline {
    agent any

     stages {
        stage('Checkout') {
            steps {
                // Checkout code from Git repository
                git 'https://github.com/mleers/simple-node-website.git'
            }
        }
        stage('Build') {
            steps {
                nodejs(cacheLocationStrategy: workspace(), nodeJSInstallationName: 'mypeppys') {
                    // Your build steps go here
                    // For example:
                    sh 'npm install'
                    sh 'npm run build'
                }
            }
        }


        stage('Deploy') {
            steps {
                // Deploy your application using sshPublisher
                sshPublisher(publishers: [sshPublisherDesc(
                    configName: 'mypeppys',
                    transfers: [sshTransfer(
                        cleanRemote: false,
                        excludes: '',
                        execCommand: '',
                        flatten: false,
                        makeEmptyDirs: false,
                        noDefaultExcludes: false,
                        patternSeparator: '[, ]+',
                        remoteDirectory: '/',
                        remoteDirectorySDF: false,
                        removePrefix: '',
                        sourceFiles: '.next/**, package.json, .env, next.config.js, package-lock.json, next-env.d.ts, .eslintrc.json, dbmgmt/**, tsconfig.json, public/**, src/**'
                    )],
                    usePromotionTimestamp: false,
                    useWorkspaceInPromotion: false,
                    verbose: false
                )])
            }
        }
    }
}
